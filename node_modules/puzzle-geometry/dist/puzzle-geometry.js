!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["puzzle-geometry"]=t():e["puzzle-geometry"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";class Quat{constructor(e,t,r,s){this.a=e,this.b=t,this.c=r,this.d=s}mul(e){return new Quat(this.a*e.a-this.b*e.b-this.c*e.c-this.d*e.d,this.a*e.b+this.b*e.a+this.c*e.d-this.d*e.c,this.a*e.c-this.b*e.d+this.c*e.a+this.d*e.b,this.a*e.d+this.b*e.c-this.c*e.b+this.d*e.a)}toString(){return"Q["+this.a+","+this.b+","+this.c+","+this.d+"]"}dist(e){return Math.hypot(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}len(){return Math.hypot(this.a,this.b,this.c,this.d)}cross(e){return new Quat(0,this.c*e.d-this.d*e.c,this.d*e.b-this.b*e.d,this.b*e.c-this.c*e.b)}dot(e){return this.b*e.b+this.c*e.c+this.d*e.d}normalize(){var e=Math.sqrt(this.dot(this));return new Quat(this.a/e,this.b/e,this.c/e,this.d/e)}makenormal(){return new Quat(0,this.b,this.c,this.d).normalize()}normalizeplane(){var e=Math.hypot(this.b,this.c,this.d);return new Quat(this.a/e,this.b/e,this.c/e,this.d/e)}smul(e){return new Quat(this.a*e,this.b*e,this.c*e,this.d*e)}sum(e){return new Quat(this.a+e.a,this.b+e.b,this.c+e.c,this.d+e.d)}sub(e){return new Quat(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}angle(){return 2*Math.acos(this.a)}invrot(){return new Quat(this.a,-this.b,-this.c,-this.d)}det3x3(e,t,r,s,i,o,a,n,h){return e*(i*h-o*n)+t*(o*a-s*h)+r*(s*n-i*a)}rotateplane(e){var t=e.mul(new Quat(0,this.b,this.c,this.d)).mul(e.invrot());return t.a=this.a,t}rotatepoint(e){return e.mul(this).mul(e.invrot())}rotateface(e){var t=this;return e.map(e=>e.rotatepoint(t))}rotatecubie(e){var t=this;return e.map(e=>t.rotateface(e))}intersect3(e,t){var r=this.det3x3(this.b,this.c,this.d,e.b,e.c,e.d,t.b,t.c,t.d);return!(Math.abs(r)<Quat.eps)&&new Quat(0,this.det3x3(this.a,this.c,this.d,e.a,e.c,e.d,t.a,t.c,t.d)/r,this.det3x3(this.b,this.a,this.d,e.b,e.a,e.d,t.b,t.a,t.d)/r,this.det3x3(this.b,this.c,this.a,e.b,e.c,e.a,t.b,t.c,t.a)/r)}solvethreeplanes(e,t,r,s){var i=s[e].intersect3(s[t],s[r]);if(!i)return i;for(var o=0;o<s.length;o++)if(o!=e&&o!=t&&o!=r){var a=s[o].b*i.b+s[o].c*i.c+s[o].d*i.d;if(s[o].a>0&&a>s[o].a||s[o].a<0&&a<s[o].a)return!1}return i}side(e){return e>Quat.eps?1:e<-Quat.eps?-1:0}cutfaces(e){for(var t=this,r=this.a,s=[],i=0;i<e.length;i++){for(var o=e[i],a=o.map(e=>t.side(e.dot(t)-r)),n=0,h=0;h<a.length;h++)n|=1<<a[h]+1;if(5==(5&n))for(var l=-1;l<=1;l+=2){for(var f=[],u=0;u<o.length;u++){a[u]!=l&&0!=a[u]||f.push(o[u]);var c=(u+1)%o.length;if(a[u]+a[c]==0&&0!=a[u]){var m=o[u].dot(this)-r,v=m/(m-(o[c].dot(this)-r)),p=o[u].smul(1-v).sum(o[c].smul(v));f.push(p)}}s.push(f)}else s.push(o)}return s}faceside(e){for(var t=this.a,r=0;r<e.length;r++){var s=this.side(e[r].dot(this)-t);if(0!=s)return s}throw"Could not determine side of plane in faceside"}static expandfaces(e,t){for(var r=[],s=0;s<e.length;s++)for(var i=0;i<t.length;i++){for(var o=t[i],a=[],n=0;n<o.length;n++)a.push(o[n].rotateplane(e[s]));r.push(a)}return r}sameplane(e){var t=this.normalize(),r=e.normalize();return t.dist(r)<Quat.eps||t.dist(r.smul(-1))<Quat.eps}static centermassface(e){for(var t=new Quat(0,0,0,0),r=0;r<e.length;r++)t=t.sum(e[r]);return t.smul(1/e.length)}makecut(e){return new Quat(e,this.b,this.c,this.d)}static random(){var e=new Quat(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);return e.smul(1/e.len())}}Quat.eps=1e-9;class PlatonicGenerator_PlatonicGenerator{static cube(){var e=Math.sqrt(.5);return[new Quat(e,e,0,0),new Quat(e,0,e,0)]}static tetrahedron(){return[new Quat(.5,.5,.5,.5),new Quat(.5,.5,.5,-.5)]}static dodecahedron(){var e=2*Math.PI/10,t=.5+.3*Math.sqrt(5),r=.5+.1*Math.sqrt(5),s=Math.sqrt(t*t+r*r);return t/=s,r/=s,[new Quat(Math.cos(e),t*Math.sin(e),r*Math.sin(e),0),new Quat(.5,.5,.5,.5)]}static icosahedron(){var e=1/6+Math.sqrt(5)/6,t=2/3+Math.sqrt(5)/3,r=Math.sqrt(e*e+t*t);e/=r,t/=r;var s=2*Math.PI/6;return[new Quat(Math.cos(s),e*Math.sin(s),t*Math.sin(s),0),new Quat(Math.cos(s),-e*Math.sin(s),t*Math.sin(s),0)]}static octahedron(){var e=Math.sqrt(.5);return[new Quat(.5,.5,.5,.5),new Quat(e,0,0,e)]}static closure(e){for(var t=[new Quat(1,0,0,0)],r=0;r<t.length;r++)for(var s=0;s<e.length;s++){for(var i=e[s].mul(t[r]),o=i.smul(-1),a=!1,n=0;n<t.length;n++)if(i.dist(t[n])<PlatonicGenerator_PlatonicGenerator.eps||o.dist(t[n])<PlatonicGenerator_PlatonicGenerator.eps){a=!0;break}a||t.push(i)}return t}static uniqueplanes(e,t){for(var r=[],s=[],i=0;i<t.length;i++){for(var o=e.rotateplane(t[i]),a=!1,n=0;n<r.length;n++)if(o.dist(r[n])<PlatonicGenerator_PlatonicGenerator.eps){a=!0;break}a||(r.push(o),s.push(t[i]))}return s}static getface(e){for(var t=[],r=1;r<e.length;r++)for(var s=r+1;s<e.length;s++){var i=e[0].solvethreeplanes(0,r,s,e);if(i){for(var o=!1,a=0;a<t.length;a++)if(i.dist(t[a])<PlatonicGenerator_PlatonicGenerator.eps){o=!0;break}o||t.push(i)}}for(;;){var n=!1;for(r=0;r<t.length;r++){s=(r+1)%t.length;if(e[0].dot(t[r].cross(t[s]))<0){var h=t[r];t[r]=t[s],t[s]=h,n=!0}}if(!n)break}return t}}PlatonicGenerator_PlatonicGenerator.eps=1e-9;class Perm{constructor(e){this.n=e.length,this.p=e}toString(){return"Perm["+this.p.join(" ")+"]"}mul(e){for(var t=Array(this.n),r=0;r<this.n;r++)t[r]=e.p[this.p[r]];return new Perm(t)}rmul(e){for(var t=Array(this.n),r=0;r<this.n;r++)t[r]=this.p[e.p[r]];return new Perm(t)}inv(){for(var e=Array(this.n),t=0;t<this.n;t++)e[this.p[t]]=t;return new Perm(e)}static zeros(e){for(var t=Array(e),r=0;r<e;r++)t[r]=0;return t}static iota(e){for(var t=Array(e),r=0;r<e;r++)t[r]=r;return t}static e(e){return new Perm(Perm.iota(e))}static random(e){for(var t=Array(e),r=0;r<e;r++)t[r]=r;for(r=0;r<e;r++){var s=r+Math.floor((e-r)*Math.random()),i=t[r];t[r]=t[s],t[s]=i}return new Perm(t)}compareTo(e){for(var t=0;t<this.n;t++)if(this.p[t]!=e.p[t])return this.p[t]-e.p[t];return 0}toGap(){for(var e=new Array,t=new Array(this.n),r=0;r<this.p.length;r++)if(!t[r]&&this.p[r]!=r){for(var s=new Array,i=r;!t[i];i=this.p[i])s.push(1+i),t[i]=!0;e.push("("+s.join(",")+")")}return e.join("")}static factorial(e){for(var t=1;e>1;)t*=e,e--;return t}static gcd(e,t){if(e>t){var r=e;e=t,t=r}for(;e>0;){var s=t%e;t=e,e=s}return t}static lcm(e,t){return e/Perm.gcd(e,t)*t}order(){for(var e=1,t=new Array(this.n),r=0;r<this.p.length;r++)if(!t[r]&&this.p[r]!=r){for(var s=0,i=r;!t[i];i=this.p[i])s++,t[i]=!0;e=Perm.lcm(e,s)}return e}}class PermOriSet_OrbitDef{constructor(e,t){this.size=e,this.mod=t}reassemblySize(){return Perm.factorial(this.size)*Math.pow(this.mod,this.size)}}class OrbitsDef{constructor(e,t,r,s,i){this.orbitnames=e,this.orbitdefs=t,this.solved=r,this.movenames=s,this.moveops=i}toKsolve(e,t){var r=[];r.push("Name "+e),r.push("");for(var s=0;s<this.orbitnames.length;s++)r.push("Set "+this.orbitnames[s]+" "+this.orbitdefs[s].size+" "+this.orbitdefs[s].mod);r.push(""),r.push("Solved");for(s=0;s<this.orbitnames.length;s++){r.push(this.orbitnames[s]);var i=this.solved.orbits[s].toKsolveVS();r.push(i[0]),r.push(i[1])}r.push("End"),r.push("");for(s=0;s<this.movenames.length;s++){r.push("Move "+this.movenames[s]);for(var o=0;o<this.orbitnames.length;o++)if(t||!this.moveops[s].orbits[o].isIdentity()){r.push(this.orbitnames[o]);i=this.moveops[s].orbits[o].toKsolve();r.push(i[0]),r.push(i[1])}r.push("End"),r.push("")}return r}optimize(){for(var e=[],t=[],r=[],s=[],i=0;i<this.moveops.length;i++)s.push([]);for(var o=0;o<this.orbitdefs.length;o++){for(var a=this.orbitdefs[o].mod,n=this.orbitdefs[o].size,h=new DisjointUnion(n),l=new Array(this.orbitdefs[o].size),f=0;f<n;f++)l[f]=!1;for(i=0;i<this.moveops.length;i++)for(f=0;f<n;f++)this.moveops[i].orbits[o].perm[f]==f&&0==this.moveops[i].orbits[o].ori[f]||(l[f]=!0,h.union(f,this.moveops[i].orbits[o].perm[f]));var u=!0;if(a>1){u=!1;var c=new DisjointUnion(this.orbitdefs[o].size*a);for(i=0;i<this.moveops.length;i++)for(f=0;f<n;f++)if(this.moveops[i].orbits[o].perm[f]!=f||0!=this.moveops[i].orbits[o].ori[f])for(var m=0;m<a;m++)c.union(f*a+m,this.moveops[i].orbits[o].perm[f]*a+(m+this.moveops[i].orbits[o].ori[f])%a);for(i=0;!u&&i<n;i++)for(m=1;m<a;m++)c.find(i*a)==c.find(i*a+m)&&(u=!0);for(i=0;!u&&i<n;i++)for(f=0;f<i;f++)this.solved.orbits[o].perm[i]==this.solved.orbits[o].perm[f]&&(u=!0)}var v=-1,p=!1;for(i=0;i<this.orbitdefs[o].size;i++)if(l[i]){var d=h.find(i);v<0?v=d:v!=d&&(p=!0)}for(i=0;i<this.orbitdefs[o].size;i++){if(l[i])if((d=h.find(i))==i){var g=[],b=[],P=0;for(f=0;f<this.orbitdefs[o].size;f++)h.find(f)==i&&(g[P]=f,b[f]=P,P++);if(p?e.push(this.orbitnames[o]+"_p"+i):e.push(this.orbitnames[o]),u){t.push(new PermOriSet_OrbitDef(P,this.orbitdefs[o].mod)),r.push(this.solved.orbits[o].remapVS(g,P));for(f=0;f<this.moveops.length;f++)s[f].push(this.moveops[f].orbits[o].remap(g,b,P))}else{t.push(new PermOriSet_OrbitDef(P,1)),r.push(this.solved.orbits[o].remapVS(g,P).killOri());for(f=0;f<this.moveops.length;f++)s[f].push(this.moveops[f].orbits[o].remap(g,b,P).killOri())}}}}return new OrbitsDef(e,t,new VisibleState(r),this.movenames,s.map(e=>new Transformation(e)))}scramble(e){for(var t=[],r=0;r<this.moveops.length;r++)t[r]=this.moveops[r];for(r=0;r<t.length;r++){var s=Math.floor(Math.random()*t.length),i=t[r];t[r]=t[s],t[s]=i}e<t.length&&(e=t.length);for(r=0;r<e;r++){var o=Math.floor(Math.random()*t.length),a=Math.floor(Math.random()*t.length),n=Math.floor(Math.random()*this.moveops.length);t[o]=t[o].mul(t[a]).mul(this.moveops[n]),Math.random()<.1&&(t[o]=t[o].mul(this.moveops[n]))}var h=t[0];for(r=1;r<t.length;r++)h=h.mul(t[r]);this.solved=this.solved.mul(h)}reassemblySize(){for(var e=1,t=0;t<this.orbitdefs.length;t++)e*=this.orbitdefs[t].reassemblySize();return e}}class PermOriSet_Orbit{constructor(e,t,r){this.perm=e,this.ori=t,this.orimod=r}mul(e){for(var t=this.perm.length,r=new Array(t),s=new Array(t),i=0;i<t;i++)r[i]=this.perm[e.perm[i]],s[i]=(this.ori[e.perm[i]]+e.ori[i])%this.orimod;return new PermOriSet_Orbit(r,s,this.orimod)}inv(){for(var e=this.perm.length,t=new Array(e),r=new Array(e),s=0;s<e;s++)t[this.perm[s]]=s,r[this.perm[s]]=(this.orimod-this.ori[s])%this.orimod;return new PermOriSet_Orbit(t,r,this.orimod)}equal(e){for(var t=this.perm.length,r=0;r<t;r++)if(this.perm[r]!=e.perm[r]||this.ori[r]!=e.ori[r])return!1;return!0}killOri(){for(var e=this.perm.length,t=0;t<e;t++)this.ori[t]=0;return this.orimod=1,this}toPerm(){var e=this.orimod;if(1==e)return new Perm(this.perm);for(var t=this.perm.length,r=new Array(t*e),s=0;s<t;s++)for(var i=0;i<e;i++)r[s*e+i]=e*this.perm[s]+(this.ori[s]+i)%e;return new Perm(r)}identicalPieces(){for(var e=[],t=this.perm.length,r=[],s=0;s<t;s++){var i=this.perm[s];if(void 0==e[i]){var o=[s];e[i]=!0;for(var a=s+1;a<t;a++)this.perm[a]==i&&o.push(a);r.push(o)}}return r}order(){return this.toPerm().order()}static e(e,t){return new PermOriSet_Orbit(Perm.iota(e),Perm.zeros(e),t)}isIdentity(){for(var e=this.perm.length,t=0;t<e;t++)if(this.perm[t]!=t||0!=this.ori[t])return!1;return!0}remap(e,t,r){for(var s=new Array(r),i=new Array(r),o=0;o<r;o++)s[o]=t[this.perm[e[o]]],i[o]=this.ori[e[o]];return new PermOriSet_Orbit(s,i,this.orimod)}remapVS(e,t){for(var r=new Array(t),s=new Array(t),i=0,o=[],a=0;a<t;a++){var n=this.perm[e[a]];void 0==o[n]&&(o[n]=i++),r[a]=o[n],s[a]=this.ori[e[a]]}return new PermOriSet_Orbit(r,s,this.orimod)}toKsolveVS(){return[this.perm.map(e=>e+1).join(" "),this.ori.join(" ")]}toKsolve(){for(var e=new Array(this.ori.length),t=0;t<e.length;t++)e[this.perm[t]]=this.ori[t];return[this.perm.map(e=>e+1).join(" "),e.join(" ")]}}class PermOriSet_TransformationBase{constructor(e){this.orbits=e}internalMul(e){for(var t=[],r=0;r<this.orbits.length;r++)t.push(this.orbits[r].mul(e.orbits[r]));return t}internalInv(){for(var e=[],t=0;t<this.orbits.length;t++)e.push(this.orbits[t].inv());return e}equal(e){for(var t=0;t<this.orbits.length;t++)if(!this.orbits[t].equal(e.orbits[t]))return!1;return!0}killOri(){for(var e=0;e<this.orbits.length;e++)this.orbits[e].killOri();return this}toPerm(){for(var e=new Array,t=0,r=0;r<this.orbits.length;r++){var s=this.orbits[r].toPerm();e.push(s),t+=s.n}var i=new Array(t);t=0;for(r=0;r<this.orbits.length;r++){s=e[r];for(var o=0;o<s.n;o++)i[t+o]=t+s.p[o];t+=s.n}return new Perm(i)}identicalPieces(){for(var e=[],t=0,r=0;r<this.orbits.length;r++){for(var s=this.orbits[r].orimod,i=this.orbits[r].identicalPieces(),o=0;o<i.length;o++)e.push(i[o].map(e=>e*s+t));t+=s*this.orbits[r].perm.length}return e}order(){for(var e=1,t=0;t<this.orbits.length;t++)e=Perm.lcm(e,this.orbits[t].order());return e}}class Transformation extends PermOriSet_TransformationBase{constructor(e){super(e)}mul(e){return new Transformation(this.internalMul(e))}mulScalar(e){if(0==e)return this.e();var t=this;for(e<0&&(t=t.inv(),e=-e);0==(1&e);)t=t.mul(t),e>>=1;if(1==e)return t;for(var r=t,s=this.e();e>0;)1&e&&(s=s.mul(r)),e>1&&(r=r.mul(r)),e>>=1;return s}inv(){return new Transformation(this.internalInv())}e(){return new Transformation(this.orbits.map(e=>PermOriSet_Orbit.e(e.perm.length,e.orimod)))}}class VisibleState extends PermOriSet_TransformationBase{constructor(e){super(e)}mul(e){return new VisibleState(this.internalMul(e))}}class DisjointUnion{constructor(e){this.n=e,this.heads=new Array(e);for(var t=0;t<e;t++)this.heads[t]=t}find(e){var t=this.heads[e];return this.heads[t]==t?t:(t=this.find(this.heads[t]),this.heads[e]=t,t)}union(e,t){var r=this.find(e),s=this.find(t);r<s?this.heads[s]=r:r>s&&(this.heads[r]=s)}}class PuzzleGeometry_PuzzleGeometry{constructor(e,t,r){if(this.args="",this.cmovesbyslice=[],this.verbose=1,this.allmoves=!1,this.cornersets=!0,this.centersets=!0,this.edgesets=!0,this.killorientation=!1,this.optimize=!1,this.scramble=0,this.fixPiece="",this.fixedCubie=-1,this.net=[],this.colors=[],this.faceorder=[],this.faceprecedence=[],void 0!=r){if(r.length%2!=0)throw"Odd length in option list?";for(var s=0;s<r.length;s+=2)if("verbose"==r[s])this.verbose++;else if("quiet"==r[s])this.verbose=0;else if("allmoves"==r[s])this.allmoves=r[s+1];else if("outerblockmoves"==r[s])this.outerblockmoves=r[s+1];else if("vertexmoves"==r[s])this.vertexmoves=r[s+1];else if("cornersets"==r[s])this.cornersets=r[s+1];else if("centersets"==r[s])this.centersets=r[s+1];else if("edgesets"==r[s])this.edgesets=r[s+1];else if("movelist"==r[s])this.movelist=r[s+1];else if("killorientation"==r[s])this.killorientation=r[s+1];else if("optimize"==r[s])this.optimize=r[s+1];else if("scramble"==r[s])this.scramble=r[s+1];else{if("fix"!=r[s])throw"Bad option while processing option list "+r[s];this.fixPiece=r[s+1]}}this.args=e+" "+t.map(e=>e.join(" ")).join(" "),r&&(this.args+=" "+r.join(" ")),this.verbose>0&&console.log(this.header("# ")),this.create(e,t)}static findelement(e,t){for(var r=0;r<e.length;r++)if(e[r][0].dist(t)<PuzzleGeometry_PuzzleGeometry.eps)return r;throw"Element not found"}splitByFaceNames(e,t){for(var r=[],s=0;s<e.length;){for(var i=!1,o=0;o<t.length;o++)if(e.substr(s).startsWith(t[o][1])){r.push(t[o][1]),s+=t[o][1].length,i=!0;break}if(!i)throw"Could not split "+e+" into face names."}return r}create(e,t){this.moveplanes=[],this.faces=[],this.cubies=[];var r=null;switch(e){case"c":r=PlatonicGenerator_PlatonicGenerator.cube();break;case"o":r=PlatonicGenerator_PlatonicGenerator.octahedron();break;case"i":r=PlatonicGenerator_PlatonicGenerator.icosahedron();break;case"t":r=PlatonicGenerator_PlatonicGenerator.tetrahedron();break;case"d":r=PlatonicGenerator_PlatonicGenerator.dodecahedron();break;default:throw"Bad shape argument: "+e}this.rotations=PlatonicGenerator_PlatonicGenerator.closure(r),this.verbose&&console.log("# Rotations: "+this.rotations.length);var s=r[0];this.baseplanerot=PlatonicGenerator_PlatonicGenerator.uniqueplanes(s,this.rotations);var i=this.baseplanerot.map(function(e){return s.rotateplane(e)});this.baseplanes=i,this.basefacecount=i.length;var o=PuzzleGeometry_PuzzleGeometry.defaultnets[i.length];this.net=o,this.colors=PuzzleGeometry_PuzzleGeometry.defaultcolors[i.length],this.faceorder=PuzzleGeometry_PuzzleGeometry.defaultfaceorders[i.length],this.verbose&&console.log("# Base planes: "+i.length);var a=PlatonicGenerator_PlatonicGenerator.getface(i);this.verbose&&console.log("# Face vertices: "+a.length);for(var n=i[0].makenormal(),h=a[0].sum(a[1]).makenormal(),l=a[0].makenormal(),f=[],u=0;u<t.length;u++){var c=null;switch(t[u][0]){case"f":c=n;break;case"v":c=l;break;case"e":c=h;break;default:throw"Bad cut argument: "+t[u][0]}f.push(c.makecut(t[u][1]))}var m=new Quat(1,n.b,n.c,n.d);this.verbose&&console.log("# Boundary is "+m);var v=PlatonicGenerator_PlatonicGenerator.uniqueplanes(m,this.rotations).map(function(e){return m.rotateplane(e)}),p=[PlatonicGenerator_PlatonicGenerator.getface(v)],d=[],g=[],b=[],P=[],y=p[0].length;function z(e,t,r){for(var s=0;s<e.length;s++)if(e[s][0].dist(t)<PuzzleGeometry_PuzzleGeometry.eps)return void e[s].push(r);e.push([t,r])}for(u=0;u<this.baseplanerot.length;u++)for(var w=this.baseplanerot[u].rotateface(p[0]),k=0;k<w.length;k++){var G=(k+1)%w.length;z(P,_=w[k].sum(w[G]).smul(.5),u)}var x=[];for(u=0;u<this.baseplanerot.length;u++){w=this.baseplanerot[u].rotateface(p[0]);var M=[];for(k=0;k<w.length;k++){G=(k+1)%w.length;var _=w[k].sum(w[G]).smul(.5),O=P[PuzzleGeometry_PuzzleGeometry.findelement(P,_)];if(u==O[1])M.push(O[2]);else{if(u!=O[2])throw"Could not find edge";M.push(O[1])}}x.push(M)}var S={},Q=[];Q.push(o[0][0]),S[o[0][0]]=0,Q[x[0][0]]=o[0][1],S[o[0][1]]=x[0][0];for(u=0;u<o.length;u++){var B=S[o[u][0]];if(void 0==B)throw"Bad edge description; first edge not connected";var j=-1;for(k=0;k<x[B].length;k++){if(void 0!=(D=Q[x[B][k]])&&D==o[u][1]){j=k;break}}if(j<0)throw"First element of a net not known";for(k=2;k<o[u].length;k++)if(""!=o[u][k]){var D,F=x[B][(k+j-1)%y];if(void 0!=(D=Q[F])&&D!=o[u][k])throw"Face mismatch in net";Q[F]=o[u][k],S[o[u][k]]=F}}for(u=0;u<Q.length;u++){var A=!1;for(k=0;k<this.faceorder.length;k++)if(Q[u]==this.faceorder[k]){this.faceprecedence[u]=k,A=!0;break}if(!A)throw"Could not find face "+Q[u]+" in face order list "+this.faceorder}for(u=0;u<this.baseplanerot.length;u++){w=this.baseplanerot[u].rotateface(p[0]);var R=m.rotateplane(this.baseplanerot[u]),C=Q[u];d.push([w,C]),g.push([R,C])}for(u=0;u<this.baseplanerot.length;u++)for(w=this.baseplanerot[u].rotateface(p[0]),C=Q[u],k=0;k<w.length;k++){G=(k+1)%w.length,_=w[k].sum(w[G]).smul(.5);var E=(k+2)%w.length,T=w[G].sum(w[E]).smul(.5),L=PuzzleGeometry_PuzzleGeometry.findelement(P,_),N=PuzzleGeometry_PuzzleGeometry.findelement(P,T);z(b,w[G],[C,N,L])}for(u=0;u<P.length;u++){if(3!=P[u].length)throw"Bad length in edge names "+P[u];var I=Q[P[u][1]],q=Q[P[u][2]];this.faceprecedence[P[u][1]]<this.faceprecedence[P[u][2]]?I+=q:I=q+I,P[u]=[P[u][0],I]}this.cornerfaces=b[0].length-1;for(u=0;u<b.length;u++){if(b[u].length<4)throw"Bad length in vertex names";var U=1;for(k=2;k<b[u].length;k++)this.faceprecedence[S[b[u][k][0]]]<this.faceprecedence[S[b[u][U][0]]]&&(U=k);var K="";for(k=1;k<b[u].length;k++){K+=b[u][U][0];for(var V=1;V<b[u].length;V++)if(b[u][U][2]==b[u][V][1]){U=V;break}}b[u]=[b[u][0],K]}this.verbose>1&&(console.log("Face precedence list: "+this.faceorder.join(" ")),console.log("Face names: "+d.map(e=>e[1]).join(" ")),console.log("Edge names: "+P.map(e=>e[1]).join(" ")),console.log("Vertex names: "+b.map(e=>e[1]).join(" ")));var J=[];for(u=0;u<g.length;u++)J.push([g[u][0].makenormal(),g[u][1],"f"]);for(u=0;u<P.length;u++)J.push([P[u][0].makenormal(),P[u][1],"e"]);for(u=0;u<b.length;u++)J.push([b[u][0].makenormal(),b[u][1],"v"]);this.facenames=d,this.faceplanes=g,this.edgenames=P,this.vertexnames=b,this.geonormals=J;var H=new Quat(0,0,0,0);this.edgedistance=p[0][0].sum(p[0][1]).smul(.5).dist(H),this.vertexdistance=p[0][0].dist(H),this.verbose&&console.log("# Distances: face 1 edge "+this.edgedistance+" vertex "+this.vertexdistance);for(var W=0;W<f.length;W++)for(u=0;u<this.rotations.length;u++){var Z=f[W].rotateplane(this.rotations[u]),$=!1;for(k=0;k<this.moveplanes.length;k++)if(Z.sameplane(this.moveplanes[k])){$=!0;break}$||(this.moveplanes.push(Z),p=Z.cutfaces(p))}this.faces=p,this.verbose&&console.log("# Faces is now "+p.length),this.stickersperface=p.length;var X=1e99;for(u=0;u<p.length;u++)for(k=0;k<p[u].length;k++){V=(k+1)%p[u].length;var Y=p[u][k].dist(p[u][V]);Y<X&&(X=Y)}this.shortedge=X,this.verbose&&console.log("# Short edge is "+X)}keyface(e){for(var t="",r=0;r<this.moveplanesets.length;r++){for(var s=0,i=0;i<this.moveplanesets[r].length;i++)this.moveplanesets[r][i].faceside(e)>0&&s++;t=t+" "+s}return t}findcubie(e){return this.facetocubies[this.findface(e)][0]}findface(e){for(var t=Quat.centermassface(e),r=this.keyface(e),s=0;s<this.facelisthash[r].length;s++){var i=this.facelisthash[r][s];if(Math.abs(t.dist(Quat.centermassface(this.faces[i])))<PuzzleGeometry_PuzzleGeometry.eps)return i}throw"Could not find face."}project2d(e,t,r){var s=this.facenames[e][0],i=(t+1)%s.length,o=this.baseplanes[e],a=s[i].sub(s[t]),n=a.len(),h=(a=a.normalize()).cross(o).normalize(),l=r[1].sub(r[0]),f=l.len()/n,u=(l=l.normalize()).b,c=l.c,m=a.smul(u).sub(h.smul(c)).smul(f),v=h.smul(u).sum(a.smul(c)).smul(f);return[m,v,new Quat(0,r[0].b-m.dot(s[t]),r[0].c-v.dot(s[t]),0)]}allstickers(){this.faces=Quat.expandfaces(this.baseplanerot,this.faces),this.verbose&&console.log("# Total stickers is now "+this.faces.length);for(var e=[],t=0;t<this.moveplanes.length;t++){for(var r=!1,s=(h=this.moveplanes[t]).makenormal(),i=0;i<e.length;i++)if(s.sameplane(e[i][0].makenormal())){e[i].push(h),r=!0;break}r||e.push([h])}for(t=0;t<e.length;t++){var o=(l=e[t].map(function(e){return e.normalizeplane()}))[0].makenormal();for(i=0;i<l.length;i++)l[i].makenormal().dist(o)>PuzzleGeometry_PuzzleGeometry.eps&&(l[i]=l[i].smul(-1));l.sort(function(e,t){return e.a-t.a}),e[t]=l}this.moveplanesets=e;var a=e.map(function(e){return e.length});this.verbose&&console.log("# Move plane sets: "+a);var n=[];for(t=0;t<e.length;t++)n.push([]);for(t=0;t<this.rotations.length;t++){var h=this.rotations[t];if(!(Math.abs(Math.abs(h.a)-1)<PuzzleGeometry_PuzzleGeometry.eps))for(s=h.makenormal(),i=0;i<e.length;i++)if(s.sameplane(e[i][0].makenormal())){n[i].push(h);break}}this.moverotations=n;for(t=0;t<n.length;t++){var l;for(o=(l=n[t])[0].makenormal(),i=0;i<l.length;i++)o.dist(l[i].makenormal())>PuzzleGeometry_PuzzleGeometry.eps&&(l[i]=l[i].smul(-1));l.sort(function(e,t){return e.angle()-t.angle()}),n[t][0].dot(e[t][0])<0&&l.reverse()}a=n.map(function(e){return 1+e.length});this.movesetorders=a;var f=[];for(t=0;t<e.length;t++){var u=e[t][0].makenormal(),c=null,m=null;for(i=0;i<this.geonormals.length;i++){var v=u.dot(this.geonormals[i][0]);Math.abs(v-1)<PuzzleGeometry_PuzzleGeometry.eps?m=[this.geonormals[i][1],this.geonormals[i][2]]:Math.abs(v+1)<PuzzleGeometry_PuzzleGeometry.eps&&(c=[this.geonormals[i][1],this.geonormals[i][2]])}if(null==m||null==c)throw"Saw positive or negative sides as null";f.push([m[0],m[1],c[0],c[1],1+e[t].length])}this.movesetgeos=f;var p={},d={},g={},b=[],P=[],y=this.faces;for(t=0;t<y.length;t++){var z=y[t];if(p[_=this.keyface(z)]||(g[_]=P.length,b.push(_),p[_]=[],d[_]=[],P.push(p[_])),d[_].push(t),p[_].push(z),d[_].length==this.basefacecount){this.verbose&&console.log("# Splitting core.");for(var w=0;w<this.basefacecount;w++){var k=_+" "+w;d[k]=[d[_][w]],p[k]=[p[_][w]],b.push(k),g[k]=P.length,P.push(p[k])}p[_]=[],P[g[_]]=[]}}this.cubiekey=g,this.facelisthash=d,this.cubiekeys=b,this.verbose&&console.log("# Cubies: "+Object.keys(p).length);var G=this;function x(e){var t=G.stickersperface;return Math.floor(e/t)}this.cubies=P;for(var M=0;M<P.length;M++){if(!((ee=P[M]).length<2)&&ee.length!=this.basefacecount){if(ee.length>5)throw"Bad math; too many faces on this cubie "+ee.length;for(var _,O=d[_=this.keyface(ee[0])],S=ee.map(function(e){return Quat.centermassface(e)}),Q=Quat.centermassface(S),B=0;ee.length>2;B++){var j=!1;for(t=0;t<ee.length;t++){i=(t+1)%ee.length,Q.dot(S[t].cross(S[i]));if(Q.dot(S[t].cross(S[i]))<0){var D=ee[t];ee[t]=ee[i],ee[i]=D;var F=S[t];S[t]=S[i],S[i]=F;var A=O[t];O[t]=O[i],O[i]=A,j=!0}}if(!j)break;if(B>1e3)throw"Bad epsilon math; too close to border"}var R=0,C=this.findface(ee[R]);for(t=1;t<ee.length;t++){var E=this.findface(ee[t]);this.faceprecedence[x(E)]<this.faceprecedence[x(C)]&&(R=t,C=E)}if(0!=R){var T=ee.slice(),L=O.slice();for(t=0;t<ee.length;t++)ee[t]=T[(R+t)%ee.length],O[t]=L[(R+t)%ee.length]}}}var N=[];for(t=0;t<P.length;t++)for(O=d[b[t]],i=0;i<O.length;i++)N[O[i]]=[t,i];this.facetocubies=N;var I=["?","CENTER","EDGE","CORNER","C4RNER","C5RNER"],q=[],U=[0,0,0,0,0,0],K=[],V=[],J=0,H=[],W=[],Z=[],$=[];function X(e){return P[e].map(e=>x(G.findface(e))).join(" ")}var Y=[];for(t=0;t<P.length;t++){var ee;if(!V[t])if(0!=(ee=P[t]).length){var te={},re=0;Z.push(0),Y.push([]);var se=ee.length,ie=U[se]++,oe=I[se];void 0!=oe&&se!=this.basefacecount||(oe="CORE"),oe+=0==ie?"":ie+1,q[J]=oe,K[J]=se;var ae=[t],ne=0;for(V[t]=!0;ne<ae.length;){var he=ae[ne++],le=X(he);(ee.length>1||void 0==te[le])&&(te[le]=re++),$[he]=te[le],H[he]=J,Y[J].push(he),W[he]=Z[J]++;for(i=0;i<n.length;i++){var fe=this.findcubie(n[i][0].rotateface(P[he][0]));V[fe]||(ae.push(fe),V[fe]=!0)}}J++}}if(this.orbits=Z.length,this.cubiesetnums=H,this.cubieordnums=W,this.cubiesetnames=q,this.cubieords=Z,this.orbitoris=K,this.cubievaluemap=$,this.cubiesetcubies=Y,""!=this.fixPiece){for(t=0;t<P.length;t++)if("v"==this.fixPiece&&P[t].length>2||"e"==this.fixPiece&&2==P[t].length||"f"==this.fixPiece&&1==P[t].length){this.fixedCubie=t;break}if(this.fixedCubie<0)throw"Could not find a cubie of type "+this.fixPiece+" to fix."}this.verbose&&console.log("# Cubie orbit sizes "+Z)}spinmatch(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;try{var r=this.splitByFaceNames(e,this.facenames),s=this.splitByFaceNames(t,this.facenames);if(r.length!=s.length)return!1;for(var i=0;i<r.length;i++)if(r[i]==s[0]){for(var o=0;o<s.length;o++)if(r[(i+o)%r.length]!=s[o])return!1;return!0}return!1}catch(e){return!1}}parsemove(e){var t=RegExp("^(([0-9]+)-)?([0-9]+)?([A-Za-z]+)([-'0-9]+)?$"),r=e.match(t);if(null==r)throw"Bad move passed "+e;for(var s=r[4],i=void 0,o=-1,a=s.toUpperCase(),n=!1,h=0;h<this.movesetgeos.length;h++){var l=this.movesetgeos[h];this.spinmatch(l[0],a)&&(n=!0,i=l,o=h),this.spinmatch(l[2],a)&&(n=!1,i=l,o=h)}var f=1,u=1;if(a!=s&&(u=2),void 0==i)throw"Bad grip in move "+e;if(void 0!=r[2]){if(void 0==r[3])throw"Missing second number in range";f=parseInt(r[2])}if(void 0!=r[3]&&(void 0==r[2]?(u=parseInt(r[3]),f=a==s?u:1):u=parseInt(r[3])),u--,--f<0||f>this.moveplanesets[o].length||u<0||u>this.moveplanesets[o].length)throw"Bad slice spec "+f+" "+u;var c="1",m=1;return void 0!=r[5]&&("'"==(c=r[5])[0]&&(c="-"+c.substring(1)),"+"==c[0]?c=c.substring(1):"-"==c[0]&&"-"==c&&(c="-1"),m=parseInt(c)),[e,o,f,u,n,m]}genperms(){if(!(this.cmovesbyslice.length>0)){for(var e=[],t=[],r=0;r<this.moveplanesets.length;r++){for(var s=this.moveplanesets[r],i=[],o=[],a=0;a<this.faces.length;a++){for(var n=this.faces[a],h=0,l=0;l<s.length;l++)s[l].faceside(n)<0&&h++;for(i.push(h);o.length<=h;)o.push(0);o[h]++}for(var f=[],u=[],c=0;c<o.length;c++){var m=[],v=[],p=[];for(a=0;a<this.faces.length;a++)if(i[a]==c){for(var d=[a],g=this.facetocubies[a].slice(),b=(n=this.faces[a],a);;){i[b]=-1;var P=this.moverotations[r][0].rotateface(n);if(i[b=this.findface(P)]<0)break;if(i[b]!=c)throw"Bad movement?";d.push(b);var y=this.facetocubies[b];g.push(y[0],y[1]),n=P}d.length>1&&m.push(d),g.length>2&&!p[g[0]]&&v.push(g);for(l=0;l<g.length;l+=2)p[g[l]]=!0}f.push(m),u.push(v)}e.push(f),t.push(u)}if(this.movesbyslice=e,this.cmovesbyslice=t,void 0!=this.movelist){var z=[];for(a=0;a<this.movelist.length;a++)z.push(this.parsemove(this.movelist[a]));this.parsedmovelist=z}}}getfaces(){return this.faces.map(function(e){return e.map(function(e){return[e.b,e.c,e.d]})})}getboundarygeometry(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}getmovesets(e){var t=this.moveplanesets[e].length;if(t>30)throw"Too many slices for getmovesets bitmasks";var r=[];if(void 0!=this.parsedmovelist)for(var s=0;s<this.parsedmovelist.length;s++){var i=this.parsedmovelist[s];i[1]==e&&(i[4]?r.push((2<<i[3])-(1<<i[2])):r.push((2<<t-i[2])-(1<<t-i[3])),r.push(i[5]))}else if(this.vertexmoves&&!this.allmoves){var o=this.movesetgeos[e];if(o[1]!=o[3])for(s=0;s<t;s++)"v"!=o[1]?(this.outerblockmoves?r.push((2<<t)-(2<<s)):r.push(2<<s),r.push(1)):(this.outerblockmoves?r.push((2<<s)-1):r.push(1<<s),r.push(1))}else for(s=0;s<=t;s++)(this.allmoves||s+s!=t)&&(this.outerblockmoves?s+s>t?r.push((2<<t)-(1<<s)):r.push((2<<s)-1):r.push(1<<s),r.push(1));if(this.fixedCubie>=0){var a=1<<+this.cubiekeys[this.fixedCubie].trim().split(" ")[e],n=[];for(s=0;s<r.length;s+=2){var h=r[s];h&a&&(h=(2<<t)-1-h);for(var l=!1,f=0;f<n.length;f+=2)if(n[f]==h&&n[f+1]==r[s+1]){l=!0;break}l||(n.push(h),n.push(r[s+1]))}r=n}return r}skipbyori(e){var t=this.cubies[e].length;return 1==t&&!this.centersets||2==t&&!this.edgesets||t>2&&!this.cornersets}skipcubie(e){if(0==e.length)return!0;var t=e[0];return this.skipbyori(t)}skipset(e){if(0==e.length)return!0;var t=e[0];return this.skipbyori(this.facetocubies[t][0])}header(e){return e+PuzzleGeometry_PuzzleGeometry.copyright+"\n"+e+this.args+"\n"}writegap(){for(var e=this.getOrbitsDef(!1),t=[],r=[],s=0;s<e.moveops.length;s++){var i="M_"+e.movenames[s];r.push(i),t.push(i+":="+e.moveops[s].toPerm().toGap()+";")}t.push("Gen:=["),t.push(r.join(",")),t.push("];");var o=e.solved.identicalPieces();return t.push("ip:=["+o.map(e=>"["+e.map(e=>e+1).join(",")+"]").join(",")+"];"),t.push(""),this.header("# ")+t.join("\n")}getmovename(e,t,r){for(var s=0,i=!1,o=0;o<=r;o++)t>>o&1&&(s|=1<<r-o);s<t&&(e=[e[2],e[3],e[0],e[1]],t=s,i=!0);for(var a=e[0],n="",h=0;t>>1+h;)h++;return t==1<<h?h>0&&(n=String(h+1)):t==(2<<h)-1?(a=a.toLowerCase(),h>1&&(n=String(h+1))):n="_"+t+"_",[n+a,i]}writeksolve(e,t){null==e&&(e="PuzzleGeometryPuzzle");var r=this.getOrbitsDef(t);return t?r.toKsolve(e,t).join("\n"):this.header("# ")+r.toKsolve(e,t).join("\n")}getOrbitsDef(e){for(var t=[],r=[],s=[],i=0;i<this.moveplanesets.length;i++){for(var o=this.moveplanesets[i].length,a=this.getmovesets(i),n=0;n<a.length;n+=2)for(var h=0;h<n;h+=2)if(a[n]==a[h]&&a[n+1]==a[h+1])throw"Redundant moves in moveset.";var l=0;for(n=0;n<a.length;n+=2)l|=a[n];var f=this.cmovesbyslice[i];for(n=0;n<f.length;n++)if(0!=(l>>n&1)){var u=f[n];for(h=0;h<u.length;h++)if(!this.skipcubie(u[h])){var c=this.cubiesetnums[u[h][0]];t[c]?t[c]++:t[c]=1}}}for(n=0;n<this.cubiesetnames.length;n++)t[n]&&(r.push(this.cubiesetnames[n]),s.push(new PermOriSet_OrbitDef(this.cubieords[n],this.killorientation?1:this.orbitoris[n])));var m=[];for(n=0;n<this.cubiesetnames.length;n++)if(t[n]){var v=[],p=[];for(h=0;h<this.cubieords[n];h++){if(e)v.push(h);else{var d=this.cubiesetcubies[n][h];v.push(this.cubievaluemap[d])}p.push(0)}m.push(new PermOriSet_Orbit(v,p,this.killorientation?1:this.orbitoris[n]))}var g=[],b=[];for(i=0;i<this.moveplanesets.length;i++){o=this.moveplanesets[i].length,a=this.getmovesets(i);var P=this.movesetgeos[i];for(n=0;n<a.length;n+=2){var y=a[n],z=this.getmovename(P,y,o),w=z[0],k=z[1];g.push(w);for(var G=[],x=[],M=[],_=0;_<this.cubiesetnames.length;_++){v=[];for(var O=0;O<this.cubieords[_];O++)v.push(O);x.push(v);for(p=[],O=0;O<this.cubieords[_];O++)p.push(0);M.push(p)}f=this.cmovesbyslice[i];for(var S=0;S<f.length;S++)if(0!=(y>>S&1))for(u=f[S],h=0;h<u.length;h++){var Q=u[h].slice(),B=this.cubiesetnums[Q[0]];for(_=0;_<Q.length;_+=2)Q[_]=this.cubieordnums[Q[_]];var j=2,D=3;k&&(j=Q.length-2,D=Q.length-1);for(_=0;_<Q.length;_+=2)x[B][Q[(_+j)%Q.length]]=Q[_],this.killorientation?M[B][Q[_]]=0:M[B][Q[_]]=(Q[(_+D)%Q.length]-Q[(_+1)%Q.length]+this.orbitoris[B])%this.orbitoris[B]}for(_=0;_<this.cubiesetnames.length;_++)if(t[_]){for(var F=new Array(M[_].length),A=0;A<x[_].length;A++)F[A]=M[_][x[_][A]];G.push(new PermOriSet_Orbit(x[_],F,this.killorientation?1:this.orbitoris[_]))}var R=new Transformation(G);1!=a[n+1]&&(R=R.mulScalar(a[n+1])),b.push(R)}}this.ksolvemovenames=g;var C=new OrbitsDef(r,s,new VisibleState(m),g,b);return this.optimize&&(C=C.optimize()),0!=this.scramble&&C.scramble(this.scramble),C}getMovesAsPerms(){return this.getOrbitsDef(!1).moveops.map(e=>e.toPerm())}showcanon(e){!function(e,t){var r=e.moveops.length;if(r>30)throw"Canon info too big for bitmask";for(var s=[],i=[],o=0;o<r;o++){var a=e.moveops[o];s.push(a.order());for(var n=0,h=0;h<r;h++)if(h!=o){var l=e.moveops[h];a.mul(l).equal(l.mul(a))&&(n|=1<<h)}i.push(n)}for(var f={0:1},u=0;u<100;u++){var c=0,m={},v=0;for(var p in f){var d=+p,g=f[d];c+=g,v++;for(var b=0;b<s.length;b++)if(0==(d>>b&1)&&0==(d&i[b]&(1<<b)-1)){var P=d&i[b]|1<<b;void 0==m[P]&&(m[P]=0),m[P]+=(s[b]-1)*g}}t(u+": canonseq "+c+" states "+v),f=m}}(this.getOrbitsDef(!1),e)}getsolved(){for(var e=[],t=0;t<this.basefacecount;t++)for(var r=0;r<this.stickersperface;r++)e.push(t);return new Perm(e)}static getpuzzles(){return["c f 0","2x2x2","c f 0.333333333333333","3x3x3","c f 0.5 f 0","4x4x4","c f 0.6 f 0.2","5x5x5","c f 0.666666666666667 f 0.333333333333333 f 0","6x6x6","c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","7x7x7","c f 0.75 f 0.5 f 0.25 f 0","8x8x8","c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","9x9x9","c f 0.8 f 0.6 f 0.4 f 0.2 f 0","10x10x10","c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","11x11x11","c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","12x12x12","c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","13x13x13","c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","20x20x20","c v 0","skewb","c v 0.275","master skewb","c v 0 v 0.38","professor skewb","c v 0.915641442663986","compy cube","c e 0.707106781186547","helicopter","c v 0.577350269189626","dino","c e 0","little chop","t e 0","pyramorphix","t e 0.346184634065199","mastermorphix","t v 0.333333333333333 v 1.66666666666667","pyraminx","t f 0","Jing pyraminx","t e 0.866025403784437","master paramorphix","d f 0.7","megaminx","d f 0.64 f 0.82","gigaminx","d f 0","pentultimate","d v 0.93796236956","starminx","d f 0.23606797749979","starminx 2","d f 0.447213595499989","pyraminx crystal","d v 0","chopasaurus","d e 0","big chop","o f 0","skewb diamond","o f 0.333333333333333","FTO","o v 0.577350269189626","Christopher's jewel","o e 0","octastar","o v 0.433012701892219","Trajber's octahedron","i f 0","radio chop","i v 0","icosamate","i v 0.18759247376021","icosahedron 2","i v 0.18759247376021 e 0","icosahedron 3","i v 0.84","icosahedron static faces","i v 0.73","icosahedron moving faces"]}static parsedesc(e){var t=e.split(/ /).filter(Boolean);if(t.length%2==0)return!1;if("o"!=t[0]&&"c"!=t[0]&&"i"!=t[0]&&"d"!=t[0]&&"t"!=t[0])return!1;for(var r=[],s=1;s<t.length;s+=2){if("f"!=t[s]&&"v"!=t[s]&&"e"!=t[s])return!1;r.push([t[s],t[s+1]])}return[t[0],r]}generatesvg(e,t,r,s){function i(e,t){for(var r=e[1][0]-e[0][0],s=e[1][1]-e[0][1],i=2*Math.PI/t,o=Math.cos(i),a=Math.sin(i),n=2;n<t;n++){var h=r*o+s*a;s=s*o-r*a,r=h,e.push([e[n-1][0]+r,e[n-1][1]+s])}}function o(e,t,r){return'<polygon id="'+e+'" class="sticker" style="fill: '+r+'" points="'+t.map(function(e){return e[0]+" "+e[1]}).join(" ")+'"/>\n'}void 0!=e&&void 0!=t||(e=800,t=500),void 0==r&&(r=10),e-=2*r,t-=2*r;for(var a=!1,n=!1,h=!1,l=0;l<this.movesetgeos.length;l++)for(var f=this.movesetgeos[l],u=1;u<=3;u+=2)"v"==f[u]&&(a=!0),"f"==f[u]&&(h=!0),"e"==f[u]&&(n=!0);this.genperms();var c=this.getboundarygeometry().facenames[0][0].length,m=this.net;if(null==m)throw"No net?";var v={},p=0,d=0,g=1,b=0;v[m[0][0]]=[[1,0],[0,0]],i(v[m[0][0]],c);for(l=0;l<m.length;l++){if(!v[S=m[l][0]])throw"Bad edge description; first edge not connected.";for(u=1;u<m[l].length;u++){""==(j=m[l][u])||v[j]||(v[j]=[v[S][u%c],v[S][(u+c-1)%c]],i(v[j],c))}}for(var P in v){var y=v[P];for(l=0;l<y.length;l++)p=Math.min(p,y[l][0]),g=Math.max(g,y[l][0]),d=Math.min(d,y[l][1]),b=Math.max(b,y[l][1])}var z=Math.min(e/(g-p),t/(b-d)),w=.5*(e-z*(g+p)),k=.5*(t-z*(b+d)),G={},x=this.getboundarygeometry(),M={},_=[[z+w,k],[w,k]];M[m[0][0]]=_,i(M[m[0][0]],c),G[this.facenames[0][1]]=this.project2d(0,0,[new Quat(0,_[0][0],_[0][1],0),new Quat(0,_[1][0],_[1][1],0)]);var O=[];O[0]=0;for(l=0;l<m.length;l++){var S;if(!M[S=m[l][0]])throw"Bad edge description; first edge not connected.";var Q=-1;for(u=0;u<x.facenames.length;u++)if(S==x.facenames[u][1]){Q=u;break}if(Q<0)throw"Could not find first face name "+S;var B=x.facenames[Q][0];for(u=1;u<m[l].length;u++){var j;if(""!=(j=m[l][u])&&!M[j]){M[j]=[M[S][u%c],M[S][(u+c-1)%c]],i(M[j],c);for(var D=O[Q],F=B[(D+u)%c].sum(B[(D+u+c-1)%c]).smul(.5),A=PuzzleGeometry_PuzzleGeometry.findelement(x.edgenames,F),R=x.edgenames[A][1],C=this.splitByFaceNames(R,this.facenames),E=C[S==C[0]?1:0],T=-1,L=0;L<x.facenames.length;L++)if(E==x.facenames[L][1]){T=L;break}if(T<0)throw"Could not find second face name";var N=x.facenames[T][0];for(L=0;L<N.length;L++){if(N[L].sum(N[(L+1)%c]).smul(.5).dist(F)<=PuzzleGeometry_PuzzleGeometry.eps){var I=M[S][(u+c-1)%c],q=M[S][u%c];O[T]=L,G[E]=this.project2d(T,L,[new Quat(0,q[0],q[1],0),new Quat(0,I[0],I[1],0)]);break}}}}}var U=this.getsolved(),K=[],V=[];for(l=0;l<this.basefacecount;l++)K[l]=this.colors[this.facenames[l][1]];var J=0,H=0,W=Quat.random(),Z=this.basefacecount;4==Z?W=new Quat(.7043069543230507,.0617237605829268,.4546068756768417,.5417328493446099):6==Z?W=new Quat(.3419476009844782,.17612448544695208,-.42284908551877964,.8205185279339757):8==Z?W=new Quat(-.6523285484575103,.2707374015470506,.6537994145576647,.27150515611112014):12==Z?W=new Quat(-.5856747836703331,.02634133605619232,.7075560342412421,.39453217891103587):20==Z&&(W=new Quat(.7052782621769977,.6377976252204238,.30390357803973855,.05864620549043545));for(l=0;l<this.faces.length;l++){var $=this.faces[l];$=W.rotateface($);for(u=0;u<$.length;u++)J=Math.max(J,Math.abs($[u].b)),H=Math.max(H,Math.abs($[u].c))}var X=Math.min(t/H/2,(e-r)/J/4),Y=this;function ee(i,o){if(s){var a=.5*r+.25*e,n=Y.baseplanes[i].rotateplane(W).d<0?1:-1;return[r+.5*e+n*(a-o.b*X),r+.5*t+o.c*X]}var h=G[Y.facenames[i][1]];return[r+o.dot(h[0])+h[2].b,r+t-o.dot(h[1])-h[2].c]}for(l=0;l<this.faces.length;l++){$=Y.faces[l];var te=Math.floor(l/Y.stickersperface);s&&($=W.rotateface($)),V.push($.map(e=>ee(te,e)))}var re=[];for(u=0;u<this.basefacecount;u++){re.push("<g>"),re.push("<title>"+this.facenames[u][1]+"</title>\n");for(var se=0;se<this.stickersperface;se++){l=u*this.stickersperface+se;var ie=this.facetocubies[l][0],oe=this.facetocubies[l][1],ae=this.cubiesetnums[ie],ne=this.cubieordnums[ie],he=this.skipbyori(ie)?"#808080":K[U.p[l]],le=this.cubiesetnames[ae]+"-l"+ne+"-o"+oe;re.push(o(le,V[l],he))}re.push("</g>")}var fe=[];function ue(e,t,r,s){for(var i=ee(e,r),o=0;o<fe.length;o++)if(Math.hypot(i[0]-fe[o][0],i[1]-fe[o][1])<PuzzleGeometry_PuzzleGeometry.eps)return;fe.push([i[0],i[1],t,s])}for(l=0;l<this.faceplanes.length;l++){var ce=this.facenames[l][0],me=ce;if(s&&(me=W.rotateface(me)),h){var ve=this.faceplanes[l][0];s&&(ve=ve.rotatepoint(W)),ue(l,this.faceplanes[l][1],ve,c)}for(u=0;u<ce.length;u++){if(n){F=ce[u].sum(ce[(u+1)%ce.length]).smul(.5);var pe=PuzzleGeometry_PuzzleGeometry.findelement(this.edgenames,F),de=me[u].sum(me[(u+1)%ce.length]).smul(.5);ue(l,this.edgenames[pe][1],de,2)}if(a){var ge=PuzzleGeometry_PuzzleGeometry.findelement(this.vertexnames,ce[u]);ue(l,this.vertexnames[ge][1],me[u],this.cornerfaces)}}}var be='<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">\n<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>\n'+re.join("")+"</svg>";return this.svggrips=fe,be}}PuzzleGeometry_PuzzleGeometry.eps=1e-9,PuzzleGeometry_PuzzleGeometry.copyright="PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.",PuzzleGeometry_PuzzleGeometry.defaultnets={4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","N",""],["N","D","","B"],["B","N","U","M"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]},PuzzleGeometry_PuzzleGeometry.defaultcolors={4:{F:"#00ff00",D:"#ffff00",L:"#ff0000",R:"#0000ff"},6:{U:"#ffffff",F:"#00ff00",R:"#ff0000",D:"#ffff00",B:"#0000ff",L:"#ff8000"},8:{U:"#e085b9",F:"#080d99",R:"#c1e35c",D:"#22955e",B:"#9121ab",L:"#b27814",M:"#0d35ad",N:"#eb126b"},12:{U:"#ffffff",F:"#ff0000",R:"#0000ff",C:"#ff66cc",A:"#ffffd0",L:"#006633",E:"#99ff00",BF:"#ff6633",BR:"#ffff00",BL:"#660099",I:"#3399ff",D:"#999999"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}},PuzzleGeometry_PuzzleGeometry.defaultfaceorders={4:["F","D","L","R"],6:["U","D","F","B","L","R"],8:["F","B","D","U","N","L","R","M"],12:["L","E","F","BF","R","I","U","D","BR","A","BL","C"],20:["L","S","E","O","F","B","I","P","R","K","U","D","J","A","Q","H","G","N","M","C"]};class FactoredNumber{constructor(){this.mult=[]}multiply(e){for(var t=2;t*t<=e;t++)for(;e%t==0;)void 0!=this.mult[t]?this.mult[t]++:this.mult[t]=1,e/=t;e>1&&(void 0!=this.mult[e]?this.mult[e]++:this.mult[e]=1)}toString(){for(var e="",t=0;t<this.mult.length;t++)void 0!=this.mult[t]&&(""!=e&&(e+="*"),e+=t,this.mult[t]>1&&(e+="^"+this.mult[t]));return e}}class SchreierSims_SchreierSims{static schreiersims(e,t){var r=e[0].p.length,s=Perm.e(r),i=[],o=[],a=[],n=[],h=[];function l(e,t,r){n[e].push(t),h[e].push(r);for(var s=0;s<i[e].length;s++)i[e][s]&&f(e,i[e][s].mul(t),r+a[e][s])}function f(e,t,r){var s=t.p[e];if(i[e][s]){var u=t.mul(o[e][s]);(function(e){for(var t=e.p.length-1;t>=0;t--){var r=e.p[t];if(r!=t){if(!i[t][r])return!1;e=e.mul(o[t][r])}}return!0})(u)||l(e-1,u,r+a[e][s])}else{i[e][s]=t,o[e][s]=t.inv(),a[e][s]=r;for(var c=0;c<n[e].length;c++)f(e,t.mul(n[e][c]),r+h[e][c])}}return function(){i=[],o=[],n=[],a=[],h=[];for(var f=0;f<r;f++)i.push([]),o.push([]),a.push([]),n.push([]),h.push([]),i[f][f]=s,o[f][f]=s,a[f][f]=0;var u=[],c=0,m=1;for(f=0;f<e.length;f++){l(r-1,e[f],1),m=1;for(var v=0,p=0,d=(u=[],new FactoredNumber),g=0;g<r;g++){for(var b=0,P=0,y=0;y<r;y++)i[g][y]&&(b++,P+=a[g][y],g!=y&&c++);v+=n[g].length,m*=b,b>1&&d.multiply(b);var z=P/b;u.push(z),p+=z}t(f+": sz "+m+" T "+v+" sol "+p+" none "+c+" mults "+d)}return m}()}}r.d(t,"Quat",function(){return Quat}),r.d(t,"PlatonicGenerator",function(){return PlatonicGenerator_PlatonicGenerator}),r.d(t,"PuzzleGeometry",function(){return PuzzleGeometry_PuzzleGeometry}),r.d(t,"Perm",function(){return Perm}),r.d(t,"OrbitDef",function(){return PermOriSet_OrbitDef}),r.d(t,"OrbitsDef",function(){return OrbitsDef}),r.d(t,"Orbit",function(){return PermOriSet_Orbit}),r.d(t,"Transformation",function(){return Transformation}),r.d(t,"VisibleState",function(){return VisibleState}),r.d(t,"SchreierSims",function(){return SchreierSims_SchreierSims})}])});
//# sourceMappingURL=puzzle-geometry.js.map